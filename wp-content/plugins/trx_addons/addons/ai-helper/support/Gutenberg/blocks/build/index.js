(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,a=window.wp.editor,o=window.wp.components,r=window.wp.element,n=window.wp.apiFetch;var s=e.n(n);const l=window.ReactJSXRuntime,__=wp.i18n.__;(0,t.registerPlugin)("trx-addons-ai-helper-setting-panel",{render:()=>{const[e,t]=(0,r.useState)(!1),n=TRX_ADDONS_STORAGE.ai_helper_list_models,[i,c]=(0,r.useState)("gpt-3.5-turbo"),d=TRX_ADDONS_STORAGE.ai_helper_list_commands,[p,_]=(0,r.useState)("write_blog"),h=TRX_ADDONS_STORAGE.ai_helper_list_text_tones,[x,g]=(0,r.useState)("normal"),u=[];Object.keys(h).forEach(function(e){u.push({label:h[e],value:e})});const w=TRX_ADDONS_STORAGE.ai_helper_list_text_languages,[m,S]=(0,r.useState)("english"),b=[];Object.keys(w).forEach(function(e){b.push({label:w[e],value:e})});const O=TRX_ADDONS_STORAGE.ai_helper_list_bases,[f,A]=(0,r.useState)("prompt"),R=[];Object.keys(O).forEach(function(e){"title"==e&&p.indexOf("write_")<0&&"process_translate"!=p||"excerpt"==e&&"process_translate"!=p||["selected","content"].indexOf(e)>=0&&0===p.indexOf("write_")||R.push({label:O[e],value:e})});const[T,k]=(0,r.useState)("prompt"==f?d[p].prompt:""),[v,j]=(0,r.useState)(""),D=(e,a)=>{if(e&&e.hasOwnProperty("finish_reason")&&"queued"==e.finish_reason){var o=e.fetch_time?e.fetch_time:2e3;setTimeout(function(){(e=>{!async function(){var t=!1,a="";try{t=await s()({path:"/ai-helper/v1/fetch-answer",method:"POST",data:{thread_id:e.thread_id,run_id:e.run_id}})}catch(e){t=!1,a=e.message}D(t,a)}()})(e)},o)}else if(t(!1),e&&e.hasOwnProperty("data")&&e.hasOwnProperty("error"))if(e.data.hasOwnProperty("text")&&e.data.text){var r=e.data.text,n="",l=d[p].variations;if(l)for(var i=0;i<r.length;i++)n+='<label class="trx_addons_ai_helper_response__variant"><input name="trx_addons_ai_helper_response__variant" type="radio" value="'+r[i]+'">'+r[i]+"</label>";else n='<textarea class="trx_addons_ai_helper_response__content" name="trx_addons_ai_helper_response__content" rows="15">'+trx_addons_esc_html("string"==typeof r?r:r[0])+"</textarea>";var c=[TRX_ADDONS_STORAGE.msg_ai_helper_bt_caption_replace,TRX_ADDONS_STORAGE.msg_ai_helper_bt_caption_append,TRX_ADDONS_STORAGE.msg_caption_cancel];["process_title","process_excerpt"].indexOf(p)>=0?c=[TRX_ADDONS_STORAGE.msg_caption_apply,TRX_ADDONS_STORAGE.msg_caption_cancel]:"process_heading"==p&&(c=[TRX_ADDONS_STORAGE.msg_ai_helper_bt_caption_prepend,TRX_ADDONS_STORAGE.msg_caption_cancel]),trx_addons_msgbox_dialog('<form name="trx_addons_ai_helper_response" class="trx_addons_ai_helper_response">'+n+"</form>",TRX_ADDONS_STORAGE["msg_ai_helper_response"+(l?"_variations":"")],null,function(e,t){if(e&&e<c.length){var a=l?t.find('input[name="trx_addons_ai_helper_response__variant"]:checked').val():t.find("textarea").text();if("process_title"==p||"process_translate"==p&&"title"==f)wp.data.dispatch("core/editor").editPost({title:trx_addons_clear_tags(a)});else if("process_excerpt"==p||"process_translate"==p&&"excerpt"==f)wp.data.dispatch("core/editor").editPost({excerpt:trx_addons_clear_tags(a)});else{"process_heading"==p&&(a="<h3>"+a+"</h3>"),a=wp.blocks.serialize(wp.blocks.rawHandler({HTML:a}));var o=wp.blocks.parse(a);if("selected"==f){var r=wp.data.select("core/block-editor").getSelectedBlockCount()>1?wp.data.select("core/block-editor").getMultiSelectedBlockClientIds():[wp.data.select("core/block-editor").getSelectedBlockClientId()];1==e?"process_heading"==p?wp.data.dispatch("core/block-editor").insertBlocks(o,wp.data.select("core/block-editor").getBlockIndex(r[0],wp.data.select("core/block-editor").getSelectedBlockClientId())):wp.data.dispatch("core/block-editor").replaceBlocks(r,o):wp.data.dispatch("core/block-editor").insertBlocks(o,wp.data.select("core/block-editor").getBlockIndex(r[r.length-1],wp.data.select("core/block-editor").getSelectedBlockClientId())+1)}else 1==e?"process_heading"==p?wp.data.dispatch("core/editor").insertBlocks(o,0):wp.data.dispatch("core/editor").resetBlocks(o):wp.data.dispatch("core/editor").insertBlocks(o)}}},c,"wpforms")}else trx_addons_msgbox_warning(e.error||TRX_ADDONS_STORAGE.msg_ai_helper_error,TRX_ADDONS_STORAGE.msg_ai_helper_error);else trx_addons_msgbox_warning(a||TRX_ADDONS_STORAGE.msg_ai_helper_error)};return n&&0==Object.keys(n).length?(0,l.jsx)(a.PluginDocumentSettingPanel,{name:"trx-addons-ai-helper-panel",title:__("TRX Addons AI Helper"),className:"trx-addons-ai-helper-panel",children:(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)("p",{children:__("AI Text Generator is not available - token for access to the API for text generation is not specified")})})}):(0,l.jsxs)(a.PluginDocumentSettingPanel,{name:"trx-addons-ai-helper-panel",title:__("TRX Addons AI Helper"),className:"trx-addons-ai-helper-panel",children:[(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.SelectControl,{label:__("Model:"),value:i,onChange:e=>{c(e)},children:Object.keys(n).map(e=>"/-"==e.slice(0,2)||"\\-"==e.slice(0,2)?(0,l.jsx)("optgroup",{label:n[e]},e):(0,l.jsx)("option",{value:e,children:n[e]},e))})}),(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.SelectControl,{label:__("AI Command:"),value:p,onChange:e=>{_(e),0===e.indexOf("write_")&&-1==["prompt","title"].indexOf(f)?(A("prompt"),k(d[e].prompt)):k("prompt"==f?d[e].prompt:"")},children:Object.keys(d).map(e=>"/-"==e.slice(0,2)?(0,l.jsx)("optgroup",{label:d[e].title},e):(0,l.jsx)("option",{value:e,children:d[e].title},e))})}),"process_tone"==p&&(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.SelectControl,{label:__("Text tone:"),value:x,options:u,onChange:e=>g(e)})}),"process_translate"==p&&(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.SelectControl,{label:__("Language:"),value:m,options:b,onChange:e=>S(e)})}),(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.SelectControl,{label:__("Based on:"),value:f,options:R,onChange:e=>{A(e),k("prompt"==e?d[p].prompt:""),"prompt"==e&&j("")}})}),!1,"prompt"==f&&(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.TextareaControl,{label:__("Prompt for AI:"),help:__("Write a prompt with a brief description of what you want to get in response"),value:T,onChange:e=>k(e)})}),"prompt"!=f&&(0,l.jsx)(o.PanelRow,{children:(0,l.jsx)(o.TextareaControl,{label:__("Additional Hint for AI:"),help:__("Write a hint with additional requirements/instructions for the AI response"),value:v,onChange:e=>j(e)})}),(0,l.jsx)(o.PanelRow,{children:(0,l.jsxs)(o.Button,{variant:"primary",disabled:e,isBusy:e,className:"trx_addons_ai_helper_button",onClick:()=>{e||(t(!0),async function(){var e,t=!1,a="";try{t=await s()({path:"/ai-helper/v1/get-response",method:"POST",data:{content:"content"==f?wp.data.select("core/editor").getEditedPostAttribute("content"):"title"==f?wp.data.select("core/editor").getEditedPostAttribute("title"):"excerpt"==f?wp.data.select("core/editor").getEditedPostAttribute("excerpt"):"selected"==f?(e="",window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e||wp.data.select("core/block-editor").getSelectedBlock().attributes.content):"",model:i,command:p,base_on:f,prompt:T,hint:v,text_tone:x,text_language:m}})}catch(e){t=!1,a=e.message}D(t,a)}())},children:[(0,l.jsx)(o.Icon,{className:"trx_addons_ai_helper_button_icon",icon:e?"update":"welcome-write-blog"}),(0,l.jsx)("span",{className:"trx_addons_ai_helper_button_text",children:__("Generate")})]})})]})},icon:"rest-api"})})();